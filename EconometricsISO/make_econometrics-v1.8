#!/bin/sh
# 2014 Michael Creel <michael.creel@uab.es>
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
# set this to the network you'd like to use for the cluster

# make_econometrics: this script is used to build a live CD/USB
# image containing software, notes, and materials related to 
# my teaching and research
# 
# required packages: live-build, rsync, git, any others?

VERSION="v1.8"
# v1.0
# * initial image, to get the basics working
# v1.1
# * Octave 3.8.2 now in testing - use it, and don't install so many build libraries
# * don't use KDE libs or apps, try to reduce space
# v1.2
# * update notes
# * add octave-mpi
# v1.3
# * add julia
# v1.4
# * add xmaxima
# v1.5
# * update my stuff
# v1.6
# * update notes and examples
# v1.7
# * update notes and examples
# v1.8
# * get Econometrics from github, no need to sync home
# * usual updates


lb clean

#### packages to include on image - place names of packages you want here ####
install -d config/package-lists
cat <<PACKAGELIST > config/package-lists/econometrics.list.chroot
# configuration and tools
locales user-setup sudo git cmake build-essential
# X stuff
kde-plasma-desktop xorg kdm iceweasel okular vim-gtk vim-tiny
virtualbox-guest-utils virtualbox-guest-x11
# Apps
octave dynare octave-info
liboctave-dev octave-info octave-mpi dynare
gretl gretl-data gretl-doc gretl-common
openmpi-bin libopenmpi-dev octave-mpi
r-base-core xmaxima julia
PACKAGELIST

########## copy stuff to be added to chroot ######
install -d config/includes.chroot/etc/skel
rm -R config/includes.chroot/etc/skel/*
rsync -az econometricshome/ config/includes.chroot/etc/skel

# chroot hook: do some compilations in home directory
install -d config/hooks
cat <<CHROOTHOOK > config/hooks/econometrics.chroot
#!/bin/bash
if [ -f "/etc/skel/make_econometricshome.sh" ]; then
	cd /etc/skel
	touch this
	sh ./make_econometricshome.sh
fi	
CHROOTHOOK
chmod +x config/hooks/econometrics.chroot

lb build
